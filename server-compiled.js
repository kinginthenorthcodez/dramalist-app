(()=>{var e={252:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});const n=require("axios");var r=a.n(n),o=a(689),s=a.n(o);const l=e=>{const[t,a]=(0,o.useState)(!1),[n,l]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[d,m]=(0,o.useState)(""),[p,u]=(0,o.useState)();return s().createElement("div",{className:"card"},s().createElement("div",{className:"card-top"},t&&s().createElement("div",{className:"custom-input"},s().createElement("div",{className:"custom-input-interior"},s().createElement("input",{type:"file",className:"form-control form-control-sm",onChange:e=>u(e.target.files[0])}))),s().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top"})),s().createElement("div",{className:"card-body"},!t&&s().createElement(s().Fragment,null,s().createElement("h4",{className:"drama-title"},e.drama.name),s().createElement("p",{className:" text-muted small"},"Type: ",e.drama.type),s().createElement("p",{className:" text-muted small"},"Genre: ",e.drama.genre),s().createElement("p",{className:" text-muted small"},"Synopsis: Lorem ipsum"),!e.readOnly&&s().createElement(s().Fragment,null,s().createElement("button",{className:"btn btn small btn-primary",onClick:()=>{a(!0),l(e.drama.name),c(e.drama.type),m(e.drama.genre),u("")}},"Edit"),s().createElement("button",{className:"btn btn small btn-outline-danger",onClick:async()=>{await r().delete(`/dramas/${e.drama._id}`),e.setDramaState((t=>t.filter((t=>t._id!=e.drama._id))))}},"delete"))),t&&s().createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setDramaState((t=>t.map((t=>t._id==e.drama._id?{...t,name:n,type:i,genre:d}:t))));const o=new FormData;p&&o.append("photo",p),o.append("_id",e.drama._id),o.append("name",e.drama.name),o.append("type",e.drama.type),o.append("genre",e.drama.genre);const s=await r().post("/update-drama",o,{headers:{"Content-Type":"multipart/form-data"}});s.data&&e.setDramaState((t=>t.map((t=>t._id==e.drama._id?{...t,photo:s.data}:t))))}},s().createElement("div",{className:"mb-1"},s().createElement("input",{type:"text",autoFocus:!0,value:n,className:"form-control form-control-sm",onChange:e=>l(e.target.value)})),s().createElement("div",{className:"mb-2"},s().createElement("input",{type:"text",value:i,className:"form-control form-control-sm",onChange:e=>c(e.target.value)})),s().createElement("div",{className:"mb-3"},s().createElement("input",{type:"text",value:d,className:"form-control form-control-sm",onChange:e=>m(e.target.value)})),s().createElement("button",{className:"btn btn-sm btn-success"},"Save"),s().createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>a(!1)},"Cancel"))))}},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const{MongoClient:e,ObjectId:t}=a(13),n=a(142),r=a(860),o=a(738),s=a(109),l=a(470),i=a(441),c=a(17),d=a(689),m=a(684),p=a(252).Z,u=r(),y=o();let g;function b(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.type&&(e.body.type=""),"string"!=typeof e.body.genre&&(e.body.genre=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:s(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),type:s(e.body.type.trim(),{allowedTags:[],allowedAttributes:{}}),genre:s(e.body.genre.trim(),{allowedTags:[],allowedAttributes:{}})},a()}n.config(),u.set("view engine","ejs"),u.set("views","./views"),u.use(r.static("public")),u.use(r.json()),u.use(r.urlencoded({extended:!1})),l.ensureDirSync(c.join("public","uploaded-photos")),u.get("/",(async(e,t)=>{let a=await g.collection("cdramas").find({}).toArray();const n=m.renderToString(d.createElement("div",{className:"container"},!a.length&&d.createElement("p",null,"No dramas yet, Admin will upload soon!"),d.createElement("div",{className:"drama-grid mb-3"},a.map((e=>d.createElement(p,{key:e._id,drama:e,photo:e.photo,readOnly:!0})))),d.createElement("p",null,d.createElement("a",{href:"/admin"},"Login/manage drama list"))));t.render("home",{generatedHtml:n})})),u.use((function(e,t,a){t.set("WWW-Authenticate","Basic realm='Drama List App'"),e.headers.authorization==process.env.PWD?a():(console.log(e.headers.authorization),t.status(401).send("Only authorized user allowed.Try Agian!"))})),u.get("/admin",((e,t)=>{t.render("admin")})),u.post("/create-drama",y.single("photo"),b,(async(e,a)=>{if(e.file){const t=`${Date.now()}.jpg`;console.log("Photo:",t),await i(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const n=await g.collection("cdramas").insertOne(e.cleanData),r=await g.collection("cdramas").findOne({_id:new t(n.insertedId)});a.send(r)})),u.post("/update-drama",y.single("photo"),b,(async(e,a)=>{if(e.file){const n=`${Date.now()}.jpg`;await i(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(c.join("public","uploaded-photos",n)),e.cleanData.photo=n;const r=await g.collection("cdramas").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData});r.value.photo&&l.remove(c.join("public","uploaded-photos",r.value.photo)),a.send(n)}else g.collection("cdramas").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData}),a.send(!1)})),u.delete("/dramas/:id",(async(e,a)=>{"string"!=typeof e.params.id&&(e.params.id="");const n=g.collection("cdramas").findOne({_id:new t(e.params.id)});n.photo&&l.remove(c.join("public","uploaded-photos",n.photo)),g.collection("cdramas").deleteOne({_id:new t(e.params.id)}),a.send("Drama succussfully deleted!")})),u.get("/api/dramas",(async(e,t)=>{let a=await g.collection("cdramas").find({}).toArray();console.log("DATA: ",a),t.json(a)})),async function(){try{const t=new e(process.env.URL);await t.connect(),g=t.db(),u.listen(3e3,(()=>{console.log("Server running on port 3000!")}))}catch(e){console.error(e)}finally{console.log("Ok let go!")}}()})()})();